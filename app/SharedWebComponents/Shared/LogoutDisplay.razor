@inject NavigationManager Nav
@inject ILogger<LogoutDisplay> Logger
@inject ApiClient ApiClient

@if (ShowLogoutButton)
{
    <MudIconButton Icon="@Icons.Material.Filled.Logout" Color="Color.Inherit" Size="Size.Large"
                   Title="@title" OnClick="SignOut" />
}

@code {
		[Parameter] public bool ShowLogoutButton { get; set; } = true;
	public string title = "Logout of the app";

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
		try
		{
			Logger.LogInformation("start retrieve logout button visibility.");
			ShowLogoutButton = await ApiClient.ShowLogoutButtonAsync();
			if (ShowLogoutButton)
			{
				var userInfo = await ApiClient.GetUserInfoAsync();
				title += " " + userInfo["DisplayName"];
			}
		}
		catch (Exception e)
		{
			Logger.LogError(e.Message);
		}
	}

    private void SignOut()
    {
        Logger.LogInformation("User start logged out.");
        Nav.NavigateTo(".auth/logout", true);
    }
}